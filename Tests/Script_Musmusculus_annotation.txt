#####################
#
#Igenome was downloaded UCSC, 
#Note:It is important to have the M (additional chromosomes)
#
#Annotation file was downloaded from http://gramene.org/ and modified with the following script
#in order to have the rRNA, tRNA and additional chromosomes excluded by RepOthers-ome
#
#####################

wget ftp://ftp.ensembl.org/pub/release-93/fasta/mus_musculus/dna/Mus_musculus.GRCm38.dna.toplevel.fa.gz
gunzip Mus_musculus.GRCm38.dna.toplevel.fa.gz
awk '{if ($1 ~ /^>/){split($1,a,">");$1=">chr"a[2];}print $0}' Mus_musculus.GRCm38.dna.toplevel.fa > Mus_musculus.GRCm38.fa
mkdir bowtie2
bowtie2-build --threads $(nproc) Mus_musculus.GRCm38.fa bowtie2/genome -q
mkdir hisat2
hisat2-build -p $(nproc) Mus_musculus.GRCm38.fa hisat2/genome -q
rm Mus_musculus.GRCm38.fa

wget ftp://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_mouse/release_M18/gencode.vM18.annotation.gtf.gz
gunzip gencode.vM18.annotation.gtf.gz
grep -P "gene_type.+rRNA" gencode.vM18.annotation.gtf > Mmusculus_rtM_RNA.gtf

wget ftp://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_mouse/release_M18/gencode.vM18.tRNAs.gtf.gz
gunzip gencode.vM18.tRNAs.gtf.gz
cat gencode.vM18.tRNAs.gtf >> Mmusculus_rtM_RNA.gtf
rm gencode.vM18.tRNAs.gtf 

wget ftp://ftp.ensembl.org/pub/release-93/gff3/mus_musculus/Mus_musculus.GRCm38.93.chr.gff3.gz
gunzip Mus_musculus.GRCm38.93.chr.gff3.gz
grep -v '#' Mus_musculus.GRCm38.93.chr.gff3 |awk -F "\t" '{$1= "chr"$1;print$0;}' OFS="\t" > Mus_musculus_mod.GRCm38.93.chr.gff3
grep -P '\tchromosome\t' Mus_musculus_mod.GRCm38.93.chr.gff3 | grep -Pv 'chr\d+|chrX|chrY' >> Mmusculus_rtM_RNA.gtf


awk -F "\t" '{print $1,$4,$5,$9,$7}' OFS="\t" Mmusculus_rtM_RNA.gtf > Mmusculus_rtM_RNA.bed


rm Mus_musculus_mod.GRCm38.93.chr.gff3 Mus_musculus.GRCm38.93.chr.gff3 
